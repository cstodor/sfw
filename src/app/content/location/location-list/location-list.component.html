<div fxLayout="row" fxLayoutWrap="wrap" [formGroup]="form">

  <div fxFlex.gt-xs="25" fxFlex.gt-sm="25" fxFlex.gt-md="30" fxFlex="100">
    <mat-form-field style="width: 95%">
      <mat-select placeholder="{{ 'general.itemsPerPage' | translate}}" formControlName="limit">
        <mat-option [value]="locations.length" *ngIf="locations">{{ 'general.allItems' | translate}}</mat-option>
        <mat-option *ngFor="let option of itemsPerPageOptions" [value]="option">{{ option }}
          {{ 'general.items' | translate}}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <div fxFlex.gt-xs="50" fxFlex.gt-sm="40" fxFlex="100" style="margin-bottom: 15px">
    <input matInput style="padding:10px; width: 90%"
           placeholder="{{ 'general.typeToFilter' | translate}}"
           formControlName="searchFor"/>
  </div>

  <div fxFlex.gt-xs="25" fxFlex.gt-sm="35" fxFlex="100" style="margin-bottom: 15px">
    <a mat-raised-button color="primary" [routerLink]="['./edit/new']">
      {{ 'general.locations.list.createLocation' | translate}}
    </a>
  </div>

  <div fxFlex.gt-sm="100%" fxFlex="100" *ngIf="categories && categoryTypes && locations; else loadingTemplate">
    <ngx-datatable #myTable
                   class='material'
                   [columns]="columns"
                   [columnMode]="'force'"
                   [headerHeight]="50"
                   [footerHeight]="50"
                   [rowHeight]="'auto'"
                   [limit]="form.controls['limit'].value"
                   [rows]="locations | orderBy: ['title'] | filterBy: ['title'] : form.controls['searchFor'].value">
      <ngx-datatable-column name="Title"></ngx-datatable-column>
      <ngx-datatable-column name="Assigned Category">
        <ng-template let-row="row" let-value="id" ngx-datatable-cell-template>
          {{row.assignedCategory}}
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column name="Address" fxHide.xs>
        <ng-template let-row="row" let-value="id" ngx-datatable-cell-template>
          {{row.address.streetName}} {{row.address.houseNumber !== 0 ? row.address.houseNumber : ''}}<br/>
          {{row.address.zip}} {{row.address.city}}
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-column name="actions">
        <ng-template let-column="column" ngx-datatable-header-template>
          Actions
        </ng-template>
        <ng-template let-row="row" let-value="id" ngx-datatable-cell-template>
          <div class="button-row">
            <detail-link [objectId]="row.id"></detail-link>
            <edit-link [objectId]="row.id"></edit-link>
            <a mat-icon-button color="warn" (click)="removeLocation(row)">
              <mat-icon>delete</mat-icon>
            </a>
          </div>
        </ng-template>
      </ngx-datatable-column>

      <ngx-datatable-footer>
        <ng-template
          ngx-datatable-footer-template
          let-rowCount="rowCount"
          let-pageSize="pageSize"
          let-selectedCount="selectedCount"
          let-curPage="curPage"
          let-offset="offset">
          <div style="padding: 5px 10px">
            <div class="">{{ 'general.items' | translate}}: {{rowCount}} <!--|
              Size: {{pageSize}} |
              Current: {{curPage}} |
              Offset: {{offset}}-->
            </div>
          </div>

          <datatable-pager
            [pagerLeftArrowIcon]="'datatable-icon-left'"
            [pagerRightArrowIcon]="'datatable-icon-right'"
            [pagerPreviousIcon]="'datatable-icon-prev'"
            [pagerNextIcon]="'datatable-icon-skip'"
            [page]="curPage"
            [size]="pageSize"
            [count]="rowCount"
            [hidden]="!((rowCount / pageSize) > 1)"
            (change)="myTable.onFooterPage($event)">
          </datatable-pager>

        </ng-template>
      </ngx-datatable-footer>

    </ngx-datatable>
  </div>
</div>

<ng-template #loadingTemplate>
  LADEN
</ng-template>
